<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Culona del Tiempo</title>
    <link rel="icon" type="image/png" href="culonanaranja.png">
    
    <!-- Configuraci√≥n PWA (Modo App) -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="La Culona">
    <link rel="apple-touch-icon" href="culonanaranja.png">

    <!-- Tailwind CSS para el dise√±o responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-overlay: rgba(224, 242, 254, 0.65);
            --text-color: #1e293b;
            --card-bg: rgba(255, 255, 255, 0.85);
            --ai-bg: rgba(255, 255, 255, 0.95);
            --accent-orange: #f97316;
            --cults-purple: #7a6199;
        }

        [data-theme='dark'] {
            --bg-overlay: rgba(15, 23, 42, 0.75);
            --text-color: #f1f5f9;
            --card-bg: rgba(30, 41, 59, 0.9);
            --ai-bg: #18181b;
            --accent-orange: #fb923c;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Rubik', sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Fondo con imagen fija y desenfoque */
        .bg-fixed-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: url(mardel.jpeg); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            filter: blur(5px);
            transform: scale(1.05);
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-color: var(--bg-overlay);
            transition: background-color 0.3s ease;
        }

        /* Modal de Bienvenida */
        #welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; 
            align-items: center;
            justify-content: center;
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(6px);
            opacity: 0;
            transition: opacity 2s ease;
        }

        #welcome-modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--ai-bg);
            border: 3px solid var(--accent-orange);
            border-radius: 25px;
            max-width: 400px;
            width: 90%;
            padding: 2.5rem 2rem 2rem 2rem;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent-orange);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, background-color 0.1s;
        }

        /* Contenedor del Personaje */
        .character-container {
            width: 220px;
            height: 220px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        #star-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
            transition: filter 0.3s ease, transform 0.3s ease;
        }

        #star-img:hover {
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8)) drop-shadow(0 0 40px var(--accent-orange));
            transform: scale(1.05);
            cursor: pointer;
        }

        .temp-display {
            font-size: 6.5rem;
            font-weight: 900;
            line-height: 0.85;
            letter-spacing: -4px;
            text-shadow: 4px 4px 0px var(--accent-orange);
        }

        .location {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-orange);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        /* Estilos de Tarjetas */
        .data-card {
            background-color: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 25px;
            padding: 1.2rem;
            width: 100%;
            max-width: 340px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border: 2px solid rgba(249, 115, 22, 0.2);
            z-index: 10;
        }

        .btn-ia {
            flex: 1;
            padding: 10px 5px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.7rem;
            text-transform: uppercase;
            transition: all 0.3s ease;
            border: 3px solid var(--accent-orange);
            background: white;
            color: var(--accent-orange);
            cursor: pointer;
        }

        .btn-ia:hover {
            background-color: var(--accent-orange);
            color: white;
            transform: translateY(-2px);
        }

        #ai-modal {
            background-color: var(--ai-bg);
            color: var(--text-color);
            border: 3px dashed var(--accent-orange);
            margin-top: 10px;
        }

        /* Reproductor de M√∫sica */
        .music-player {
            width: 100%;
            max-width: 340px;
            margin-top: 1.5rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: 20px;
            padding: 0.75rem 1rem;
            border-bottom: px solid var(--accent-orange);
            z-index: 10;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 2px solid rgba(249, 115, 22, 0.2);
        }

        /* Enlaces de Redes Sociales */
        .social-link {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--accent-orange);
            transition: all 0.3s ease;
        }

        .social-link svg {
            width: 24px;
            height: 24px;
            fill: var(--text-color);
        }

        .social-link:hover {
            background-color: var(--accent-orange);
            transform: scale(1.1) translateY(-3px);
        }

        .social-link:hover svg {
            fill: white;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--accent-orange);
            cursor: pointer;
            z-index: 100;
        }

        /* Card on the top-left: #culonaxelmundo - reuses .data-card styling */
        .culona-world {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            width: 220px;
            max-width: calc(100% - 40px);
        }
        .culona-world .data-card {
            padding: 0.9rem;
            border-radius: 18px;
            font-size: 0.85rem;
            background-color: transparent; /* fondo transparente */
            box-shadow: none;
            border: none; /* sin borde naranja */
            backdrop-filter: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center; /* centrar texto dentro del card */
        }

        /* link wrapper to make the whole card clickable without changing appearance */
        .culona-world a.culona-world-link {
            color: inherit;
            text-decoration: none;
            display: block;
        }

        /* smaller typography inside the small card */
        #culona-world-content { font-size: 0.82rem; }
        .culona-world .culona-world-title { 
            font-size: 0.98rem; 
            animation: blink 3s infinite ease-in-out;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* thin black outline around text for better contrast */
        .culona-world .culona-world-title,
        .culona-world #culona-world-content {
            -webkit-text-stroke: 0.20px #000; /* thinner stroke */
            text-shadow:
                0.3px 0.3px 0 #000,
                -0.3px -0.3px 0 #000,
                0.3px -0.3px 0 #000,
                -0.3px 0.3px 0 #000;
        }

        /* Copyright Footer */
        .copyright-footer {
            margin-top: 1.5rem;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--text-color);
            opacity: 0.7;
            text-transform: uppercase;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="bg-fixed-image"></div>
    <div class="bg-overlay"></div>

    <!-- Modal de Bienvenida -->
    <div id="welcome-modal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeWelcome()">‚úï</div>
            <h2 class="text-2xl font-black mb-4 text-orange-500 uppercase tracking-tight">¬°La Estrella Culona te avisa!</h2>
            <p class="text-sm font-medium leading-relaxed">
                Una p√°gina hecha por una marplatense para todo el mundo.<br><br>
                Si tienes alguna sugerencia, manda un mensaje a alguna de mis redes al pie de la p√°gina y si quieres, puedes donarme un cafecito haciendo click 
                <a href="https://cafecito.app/camiladiaz" target="_blank" class="font-bold text-orange-600 underline hover:text-orange-700 transition-colors">aqu√≠</a>.
            </p>
        </div>
    </div>

    <!-- Bot√≥n de Cambio de Tema -->
    <button class="theme-toggle" id="themeBtn" title="Cambiar tema">
        <svg class="icon-light w-5 h-5" viewBox="0 0 24 24" fill="#FF85A1">
            <path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"/>
        </svg>
        <svg class="icon-dark hidden w-5 h-5" viewBox="0 0 24 24" fill="#38bdf8">
            <path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"/>
        </svg>
    </button>

    <!-- #culonaxelmundo (top-left card) -->
    <div class="culona-world">
        <a class="culona-world-link" href="index2.html" id="culona-world-link" aria-label="#culonaxelmundo">
            <div class="data-card">
                <div class="culona-world-title" style="font-weight:900; text-transform:uppercase; color:var(--accent-orange); letter-spacing:1px; margin-bottom:6px">#culonaxelmundo</div>
                <div id="culona-world-content" class="text-xs"></div>
            </div>
        </a>
    </div>

    <!-- Visualizaci√≥n Clima -->
    <div class="character-container">
        <img id="star-img" src="https://files.oaiusercontent.com/file-KAnY4kI0S44uLhH70eS2iY3s?se=2024-10-24T14%3A46%3A39Z&sp=r&sv=2024-08-04&sr=b&rscc=max-age%3D604800%2C%20immutable%2C%20private&rscd=attachment%3B%20filename%3DIMG_0257.jpeg&sig=Ym0n0rU8u7N9UjMvO%2Be0v0LpL/t%2BT0QoK/u8LpU%3D" alt="Estrella">
    </div>

    <div class="text-center">
        <h1 id="temp" class="temp-display">--¬∞</h1>
        <p class="location">La Feliz, MDQ</p>
    </div>

    <!-- Acciones de IA -->
    <div class="data-card">
        <div class="flex gap-3 mb-1">
            <button onclick="askAI('outfit')" class="btn-ia">Outfit üß¢</button>
            <button onclick="askAI('plan')" class="btn-ia">Plan ü™©</button>
        </div>
        <div id="ai-modal" class="hidden p-3 rounded-xl text-xs font-bold text-center leading-tight"></div>
    </div>

    <!-- Reproductor -->
    <div class="music-player">
        <div class="text-[9px] font-bold text-orange-400 text-center mb-2 uppercase tracking-widest" id="track-name">Reproductor Marplatense</div>
        <div class="flex justify-center gap-10 items-center">
            <button onclick="changeTrack(-1)" class="hover:text-orange-400 transition-colors">‚èÆÔ∏è</button>
            <button onclick="togglePlay()" id="play-btn" class="text-2xl hover:scale-110 transition-transform">‚ñ∂Ô∏è</button>
            <button onclick="changeTrack(1)" class="hover:text-orange-400 transition-colors">‚è≠Ô∏è</button>
        </div>
        <audio id="audio-element"></audio>
    </div>

    <!-- Redes Sociales -->
    <div class="mt-6 flex gap-4">
        <a href="https://www.instagram.com/lacoleccionistadetesoros3d" target="_blank" class="social-link">
            <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
        </a>
        <a href="https://x.com/cami1023ds" target="_blank" class="social-link">
            <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </a>
        <a href="https://cults3d.com/es/usuarios/CamilaDiaz/modelos-3d" target="_blank" class="social-link cults">
            <svg viewBox="0 0 100 100"><path d="M38 52 A22 22 0 1 1 60 30 A22 22 0 0 1 38 52 M38 52 A22 22 0 1 1 16 74 A22 22 0 0 1 38 52 M38 52 A22 22 0 1 1 60 74 A22 22 0 0 1 38 52" fill="none" stroke="currentColor" stroke-width="6"/></svg>
        </a>
        <a href="https://cafecito.app/camiladiaz" target="_blank" class="social-link">
            <svg viewBox="0 0 100 100">
                <path d="M25 40 L25 65 C25 75 35 85 50 85 C65 85 75 75 75 65 L75 40 Z" fill="none" stroke="currentColor" stroke-width="5"/>
                <path d="M75 45 C85 45 92 50 92 58 C92 65 85 70 75 70" fill="none" stroke="currentColor" stroke-width="5"/>
                <path d="M20 90 L80 90" fill="none" stroke="currentColor" stroke-width="5"/>
            </svg>
        </a>
    </div>

    <!-- Copyright -->
    <div class="copyright-footer">
        ¬© 2026 LA COLECCIONISTA DE TESOROS 3D
    </div>

    <script>
        // Configuraci√≥n de la API (La key se inyecta en el entorno de ejecuci√≥n)
        const apiKey = "";
        
        // Playlist Local 
        const playlist = [
            { t: "Bailando en Una Pata", file: "cancion1.mp3"},
            { t: "Me Largo a Mar Del Plata", file: "cancion2.mp3" },
            { t: "El Tema del Verano", file: "cancion3.mp3"},
            { t: "Mar Del Plata", file: "cancion4.mp3"}
        ];

        let idx = 0, isPlaying = false, weather = { t: 0 };
        let currentLat = -38.0023; // Default Mar del Plata
        let currentLon = -57.5575;
        let currentCity = "Mar del Plata";
        const audio = document.getElementById('audio-element');
        audio.volume = 0.20; // Volumen al 20%
        const playBtn = document.getElementById('play-btn');
        const trackLabel = document.getElementById('track-name');

        function initPlayer() {
            audio.src = playlist[idx].file;
            trackLabel.innerText = playlist[idx].t;
        }

        function togglePlay() {
            if (isPlaying) {
                audio.pause();
                playBtn.innerText = '‚ñ∂Ô∏è';
            } else {
                audio.play().catch(() => console.log("Se requiere interacci√≥n del usuario"));
                playBtn.innerText = '‚è∏Ô∏è';
            }
            isPlaying = !isPlaying;
        }

        function changeTrack(dir) {
            idx = (idx + dir + playlist.length) % playlist.length;
            audio.src = playlist[idx].file;
            trackLabel.innerText = playlist[idx].t;
            if (isPlaying) audio.play();
        }

        audio.onended = () => changeTrack(1);

        document.addEventListener('DOMContentLoaded', () => {
            initPlayer();
            const modal = document.getElementById('welcome-modal');
            setTimeout(() => modal.classList.add('show'), 400);
        });

        function closeWelcome() {
            const modal = document.getElementById('welcome-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.remove('show');
                audio.play().catch(() => console.log("Se requiere interacci√≥n del usuario"));
                playBtn.innerText = '‚è∏Ô∏è';
                isPlaying = true;
            }, 800);
        }

        // Obtener clima (usa coordenadas si est√°n disponibles)
        async function updateWeather(lat, lon) {
            // Use provided coords or fallback to globals/defaults
            const useLat = lat !== undefined ? lat : currentLat;
            const useLon = lon !== undefined ? lon : currentLon;

            try {
                // Solicitar el clima actual usando Open-Meteo (m√°s robusto con current_weather)
                const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${useLat}&longitude=${useLon}&current_weather=true&temperature_unit=celsius`);
                const d = await r.json();

                // Compatibilidad con diferentes respuestas
                let temp = null;
                if (d.current_weather && typeof d.current_weather.temperature === 'number') {
                    temp = d.current_weather.temperature;
                } else if (d.current && typeof d.current.temperature_2m === 'number') {
                    temp = d.current.temperature_2m;
                }

                if (temp === null) throw new Error('No temperature in response');

                weather.t = Math.round(temp);
                document.getElementById('temp').innerText = `${weather.t}¬∞`;
                // Nota: la etiqueta de ubicaci√≥n se actualiza por el reverse-geocoding
                updateCharacterImage();
            } catch (e) {
                document.getElementById('temp').innerText = "22¬∞"; // Fallback
                weather.t = 22;
                updateCharacterImage();
            }
        }

        // Reverse geocoding r√°pido usando Nominatim (OpenStreetMap)
        async function reverseGeocode(lat, lon) {
            try {
                const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&accept-language=es`);
                if (!r.ok) throw new Error('No geocode');
                const d = await r.json();
                const a = d.address || {};
                const city = a.city || a.town || a.village || a.hamlet || a.county || a.state;
                if (city) {
                    return `${city}`; // solo el nombre de la ciudad
                }
                // Fallback al primer fragmento de display_name (suele ser ciudad/barrio)
                if (d.display_name) return d.display_name.split(',')[0];
                return null;
            } catch (e) {
                console.warn('Reverse geocode failed', e);
                return null;
            }
        }
        // Intentar obtener la ubicaci√≥n del usuario y actualizar el clima
        function getLocationAndUpdateWeather() {
            if (!navigator.geolocation) {
                // Si no hay geolocalizaci√≥n, usar valores por defecto
                updateWeather(currentLat, currentLon);
                return;
            }

            // Pedimos la ubicaci√≥n; si falla o el usuario deniega, usamos fallback
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    currentLat = pos.coords.latitude;
                    currentLon = pos.coords.longitude;
                    // Actualizamos el clima de inmediato (r√°pido)
                    updateWeather(currentLat, currentLon).then(checkShortcuts);
                    const locEl = document.querySelector('.location');
                    if (locEl) locEl.innerText = 'Cargando ubicaci√≥n...';

                    // Hacemos reverse-geocoding en segundo plano y actualizamos el nombre cuando est√© listo
                    reverseGeocode(currentLat, currentLon).then((place) => {
                        // Si es Mar del Plata, usamos el nombre "La Feliz"
                        if (place && place.toLowerCase().includes("mar del plata")) {
                            currentCity = "Mar del Plata";
                            if (locEl) locEl.innerText = "La Feliz, MDQ";
                            updateBackground("Mar del Plata");
                        } else {
                            if (place) currentCity = place;
                            if (locEl) locEl.innerText = place ? place : `${currentLat.toFixed(2)}, ${currentLon.toFixed(2)}`;
                            if (place) updateBackground(place);
                        }
                    }).catch(() => {
                        if (locEl) locEl.innerText = `${currentLat.toFixed(2)}, ${currentLon.toFixed(2)}`;
                    });
                },
                (err) => {
                    // Permiso denegado o error -> fallback a Mar del Plata
                    console.warn('Geolocalizaci√≥n no disponible, usando fallback:', err);
                    currentLat = -38.0023;
                    currentLon = -57.5575;
                    currentCity = "Mar del Plata";
                    updateWeather(currentLat, currentLon).then(checkShortcuts);
                    const locEl = document.querySelector('.location');
                    if (locEl) locEl.innerText = 'La Feliz, MDQ';
                    updateBackground("Mar del Plata");
                },
                { enableHighAccuracy: false, timeout: 10000, maximumAge: 60 * 1000 }
            );
        }

        function checkShortcuts() {
            const params = new URLSearchParams(window.location.search);
            const action = params.get('action');
            if (action === 'outfit' || action === 'plan') {
                setTimeout(() => askAI(action), 500);
                // Limpiar URL para que no se ejecute de nuevo al refrescar
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function updateBackground(city) {
            const bgEl = document.querySelector('.bg-fixed-image');
            if (!bgEl) return;
            
            const cityLower = city.toLowerCase();
            // Si es Mar del Plata, usamos la imagen local original
            if (cityLower.includes('mar del plata')) {
                bgEl.style.backgroundImage = "url('mardel.jpeg')";
            } else {
                // Generar imagen basada en la ciudad (usando Pollinations.ai para evitar API Keys)
                const prompt = `panoramic view of ${city} city landmark, photography, 4k`;
                const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=1920&height=1080&nologo=true`;
                bgEl.style.backgroundImage = `url('${url}')`;
            }
        }

        function updateCharacterImage() {
            const starImg = document.getElementById('star-img');
            if (weather.t <= 20) {
                starImg.src = 'culonaazul.png';
            } else if (weather.t >= 21 && weather.t <= 23) {
                starImg.src = 'culonavioleta.png';
            } else if (weather.t >= 24) {
                starImg.src = 'culonarosa.png';
            }
        }

        // Efecto de sonido al pasar el mouse por la estrella
        const soundBlue = new Audio('hover.mp3');
        soundBlue.volume = 1.0;
        const soundViolet = new Audio('hoverculona.mp3');
        soundViolet.volume = 1.0;
        const soundPink = new Audio('calor.mp3');
        soundPink.volume = 1.0;

        document.getElementById('star-img').addEventListener('mouseenter', () => {
            let targetSound = soundBlue;
            // Si est√° entre 21 y 23 grados (Violeta), cambiamos el audio
            if (weather.t >= 21 && weather.t <= 23) targetSound = soundViolet;
            // Si hace 24 grados o m√°s (Rosa), cambiamos el audio
            if (weather.t >= 24) targetSound = soundPink;

            targetSound.currentTime = 0;
            targetSound.play().catch(() => {});
        });

        // --- L√ìGICA  MEJORADA Y R√ÅPIDA ---
        async function askAI(type) {
            if (!apiKey) {
                alert("¬°Falta la API Key! Agregala en la l√≠nea 416 del c√≥digo.");
                return;
            }

            const aiDisplay = document.getElementById('ai-modal');
            aiDisplay.classList.remove('hidden');
            aiDisplay.innerText = "La culona est√° pensando...";
            
            // Frases de respaldo por si falla la API (Offline mode) - Contextualizadas
            const isMdq = currentCity.toLowerCase().includes("mar del plata");
            let fallbacks = [];
            if (type === 'outfit') {
                if (weather.t < 18) {
                    fallbacks = ["¬°Ponete campera que chifla!", "¬°Bufanda y gorrito, hace fr√≠o!", "¬°No te olvides el abrigo!", "¬°Buzo grueso s√≠ o s√≠!"];
                } else if (weather.t > 24) {
                    fallbacks = ["¬°Ojotas y malla de una!", "¬°Ropa clara y gorra!", "¬°Protector solar y a la playa!", "¬°Musculosa y bermuda!"];
                } else {
                    fallbacks = ["¬°Llevate un buzo por las dudas!", "¬°Jean y remera van joya!", "¬°Camperita liviana clave!", "¬°Zapas c√≥modas para caminar!"];
                }
            } else {
                if (isMdq) {
                    if (weather.t < 18) {
                        fallbacks = ["¬°Chocolate caliente en la Boston!", "¬°Cine y pochoclos!", "¬°Museo MAR para resguardarse!", "¬°Cafecito mirando el mar!"];
                    } else if (weather.t > 24) {
                        fallbacks = ["¬°D√≠a de playa a full!", "¬°Licuado en el Torre√≥n!", "¬°After beach en el sur!", "¬°Chapuz√≥n en el mar!"];
                    } else {
                        fallbacks = ["¬°Unos mates en la Bristol!", "¬°Sale churros en Manolo!", "¬°Caminata por la costa!", "¬°Paseo por G√ºemes!"];
                    }
                } else {
                    // Fallbacks gen√©ricos para otras ciudades
                    if (weather.t < 18) {
                        fallbacks = ["¬°Un caf√© caliente en el centro!", "¬°Visita al museo local!", "¬°Cine y pochoclos!", "¬°A resguardarse en una cafeter√≠a!"];
                    } else if (weather.t > 24) {
                        fallbacks = ["¬°A buscar una pileta o playa!", "¬°Bebida fresca en una terraza!", "¬°Paseo por el parque con sombra!", "¬°Helado para bajar el calor!"];
                    } else {
                        fallbacks = ["¬°Caminata por la plaza principal!", "¬°A recorrer el casco hist√≥rico!", "¬°Unos mates al aire libre!", "¬°Paseo de compras!"];
                    }
                }
            }

            // Prompt unificado para mayor velocidad y compatibilidad
            const context = `Sos un habitante local de ${currentCity} muy canchero. Respond√© en 1 frase corta (m√°x 15 palabras) usando modismos propios de ${currentCity} y recomendando un lugar tur√≠stico real de ah√≠.`;
            const question = type === 'outfit' 
                ? `Hace ${weather.t}¬∞C. ¬øQu√© me pongo?` 
                : `Hace ${weather.t}¬∞C. ¬øQu√© plan sale?`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: `${context} ${question}` }] }],
                        generationConfig: {
                            maxOutputTokens: 40,
                            temperature: 1.0
                        }
                    })
                });

                if (!response.ok) throw new Error("API Error");

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "¬°Mandale mecha, che!";
                aiDisplay.innerText = ` ${text.trim()}`;
            } catch(e) { 
                console.error(e);
                // Si falla, mostramos una frase aleatoria local
                const randomFallback = fallbacks[Math.floor(Math.random() * fallbacks.length)];
                aiDisplay.innerText = ` ${randomFallback}`; 
            }
        }

        // Cambio de tema Dark/Light
        document.getElementById('themeBtn').onclick = () => {
            const current = document.documentElement.getAttribute('data-theme');
            const target = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', target);
            document.querySelector('.icon-light').classList.toggle('hidden');
            document.querySelector('.icon-dark').classList.toggle('hidden');
        };

        getLocationAndUpdateWeather();
        // Actualizar clima cada 400,000 ms
        setInterval(() => updateWeather(currentLat, currentLon), 400000);
    </script>
</body>

</html>
